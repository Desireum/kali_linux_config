!function(e){var t={};function o(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(s,i,function(t){return e[t]}.bind(null,i));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=99)}({43:function(e,t,o){"use strict";function s(){document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.dataset.i18n.split("|"),o=t[0],s=t.length>1&&"tooltip"===t[1],i=chrome.i18n.getMessage(o);i&&(e.childNodes.forEach(e=>{"#text"===e.nodeName&&(e.textContent=i)}),s&&e.setAttribute("data-tooltip",i))})}o.d(t,"a",(function(){return s}))},99:function(e,t,o){"use strict";o.r(t);var s=o(43);const i=document.querySelector("#k-button"),n=document.querySelector(".overlay"),r=document.querySelector("#kopernio-dismiss-button"),a=document.querySelector(".overlay__button");let c=-1;function d(e){chrome.runtime.sendMessage({action:"get-route-for-doi",doi:e.doi,loadBlob:!0},t=>{const o=`?doi=${e.doi}&route=${t}`;chrome.runtime.sendMessage({action:"open-new-tab",registerContextId:!0,url:`${e.host}/viewer${o}`})})}function l(e){chrome.runtime.sendMessage({action:"open-new-tab",url:e.host+"/signin?force=true"})}function u(e,t){chrome.runtime.sendMessage(e),chrome.runtime.sendMessage(t)}function v(e){const{doi:t,providerId:o,contextId:s,contentId:r,found:v,host:g,highlighterTimes:m,loggedOut:h,priority:f,correction:p}=e;chrome.runtime.sendMessage({pass:!0,action:"checkBody"});if(document.querySelector(".container").style.display="block",h){n.classList.remove("overlay--state-searching"),a.classList.remove("overlay__button--state-searching"),n.classList.add("overlay--state-fail"),a.classList.add("overlay__button--state-fail");const t=()=>{try{l(e)}catch(t){window.location.search="?sign_in=1&host="+e.host}};i.onclick=t}else chrome.runtime.sendMessage({action:"get-bg-page-profile"},({profile:l})=>{const{openUrlPrefix:h}=l;let y;if(t&&(y=t.match(/10\.\d{4,9}\/[-._;()/:A-z0-9]+/)||t.toLowerCase().startsWith("pmid:")),!v&&h&&y){if(p)return n.classList.remove("overlay--state-searching"),a.classList.remove("overlay__button--state-searching"),n.classList.add("overlay--state-fail"),void a.classList.add("overlay__button--state-fail");n.classList.remove("overlay--state-searching"),a.classList.remove("overlay__button--state-searching"),n.classList.add("overlay--state-resolver"),a.classList.add("overlay__button--state-resolver");const e=()=>{chrome.runtime.sendMessage({action:"openurl-linkout",doi:t,contextId:s})};return void(i.onclick=e)}if(!v)return n.classList.remove("overlay--state-searching"),a.classList.remove("overlay__button--state-searching"),n.classList.add("overlay--state-fail"),void a.classList.add("overlay__button--state-fail");n.classList.remove("overlay--state-searching"),a.classList.remove("overlay__button--state-searching"),n.classList.add("overlay--state-success"),a.classList.add("overlay__button--state-success");n.classList.contains("overlay--state-success")||n.classList.add("overlay--state-success");const b=f||0;if(b<c)return;c=b;i.onclick=()=>{try{d(e)}catch(e){const i=("?doi="+t).concat("&active=1","&host="+g,"&content_id="+r,"&context_id="+s,"&provider_id="+o);window.location.search=i}finally{u({pass:!0,action:"dismisshighlighter"},{action:"track-kopernio-click",doi:t,contextId:s,providerId:o}),chrome.runtime.sendMessage({pass:!0,action:"kopernio-button-clicked"})}},1===m&&chrome.runtime.sendMessage({action:"queryinjecthighlighter"},e=>{e.injectHighlighter&&chrome.runtime.sendMessage({pass:!0,action:"injecthighlighter"})})})}function g(e){if(e.active){const{doi:t,contextId:o,providerId:s}=e;v(e),d(e),u({pass:!0,action:"dismisshighlighter"},{action:"track-kopernio-click",doi:t,contextId:o,providerId:s})}else e.getStarted?function(e){chrome.runtime.sendMessage({action:"open-new-tab",url:e.host+"/get-started"})}(e):e.signIn&&l(e)}window.onload=function(){const e={doi:void 0,providerId:void 0,contentId:void 0,contextId:void 0,active:void 0,signIn:void 0,shareRequest:void 0,getStarted:void 0},t=window.location.href.split("?")[1];let o;t&&(o=new URLSearchParams(t),e.contextId=o.get("context_id"),e.contentId=o.get("content_id"),e.doi=o.get("doi"),e.providerId=o.get("provider_id"),e.host=o.get("host"),e.active=Boolean(o.get("active")),e.getStarted=Boolean(o.get("get_started")),e.signIn=Boolean(o.get("sign_in"))),chrome.runtime.sendMessage({pass:!0,action:"canarybarready"}),function(e){let t=0;chrome.runtime.onMessage.addListener((o,s,i)=>{const{doi:n,providerId:r,route:a,correction:c}=o;o.contentId===e.contentId&&("kopernio-logged-out"===o.action?v({...e,loggedOut:!0}):"show-kopernio-button"===o.action&&(i("ok"),t+=1,v({...e,doi:n,providerId:r,route:a,correction:c,found:o.found,highlighterTimes:t,version:o.version,priority:o.priority,profile:o.profile})))})}(e),n.addEventListener("mouseenter",()=>{chrome.runtime.sendMessage({pass:!0,action:"resize",resize:!0}),((e,t="is-visible")=>{e.classList.add(t)})(r)}),n.addEventListener("mouseleave",()=>{chrome.runtime.sendMessage({pass:!0,action:"resize",resize:!1}),((e,t="is-visible")=>{e.classList.remove(t)})(r)}),r.addEventListener("click",()=>{chrome.runtime.sendMessage({pass:!0,action:"dismiss-kopernio-bar"})}),g(e),chrome.runtime.onMessage.addListener((e,t)=>{"command"===e.action&&"view-pdf"===e.command&&i.onclick.apply(i)}),Object(s.a)()}}});